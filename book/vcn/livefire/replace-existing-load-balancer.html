<!DOCTYPE HTML>
<html lang="ko" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Replace existing Load Balancer - khyoon&#x27;s VMware Note</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <link rel="stylesheet" href="../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../vmware.html"><strong aria-hidden="true">1.</strong> VMware</a></li><li class="chapter-item expanded "><a href="../../vsphere/index.html"><strong aria-hidden="true">2.</strong> vSphere</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vsphere/vcenter/index.html"><strong aria-hidden="true">2.1.</strong> vCenter</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vsphere/vcenter/installation.html"><strong aria-hidden="true">2.1.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vsphere/esxi/index.html"><strong aria-hidden="true">2.2.</strong> ESXi</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vsphere/esxi/installation.html"><strong aria-hidden="true">2.2.1.</strong> Installation</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/index.html"><strong aria-hidden="true">3.</strong> VCN (Virtual Cloud Network)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/livefire/index.html"><strong aria-hidden="true">3.1.</strong> VCN Livefie 1.0</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/livefire/kicking-things-off.html"><strong aria-hidden="true">3.1.1.</strong> Kicking Things Off</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/horizon-client-invalid-ssl-certificate.html"><strong aria-hidden="true">3.1.2.</strong> Horizon Client: Invalid SSL Certificate?</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/uctilise-terraform-to-apply-edge-firewall-rules.html"><strong aria-hidden="true">3.1.3.</strong> Utilise Terraform To Apply Edge Firewall Rules</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/enable-nsx-intrusion-prevention-system.html"><strong aria-hidden="true">3.1.4.</strong> Enable NSX Intrusion Prevention System (IDS)</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/perform-multi-stage-attack-leveraging-software-vulnerabilities.html"><strong aria-hidden="true">3.1.5.</strong> Perform Multi-Stage Attack Leveraging Software Vulnerabilities</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/use-nsx-ips-to-stop-attacks-to-vulnerable-applications.html"><strong aria-hidden="true">3.1.6.</strong> Use NSX IPS to Stop Attacks to Vulnerable Applications</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/protect-vdi-via-nsx-micro-segmentation.html"><strong aria-hidden="true">3.1.7.</strong> Protect VDI via NSX Micro-Segmentation</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/lab-introduction-and-overview.html"><strong aria-hidden="true">3.1.8.</strong> Lab Introduction and Overview</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-t-cloud-preparations.html"><strong aria-hidden="true">3.1.9.</strong> NSX-T Cloud Preparations</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/setup-nsx-t-cloud.html"><strong aria-hidden="true">3.1.10.</strong> Setup NSX-T Cloud</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/replace-existing-load-balancer.html" class="active"><strong aria-hidden="true">3.1.11.</strong> Replace existing Load Balancer</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/optional-service-optimization-and-operations.html"><strong aria-hidden="true">3.1.12.</strong> Optional: Service Optimization and Operations</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/lab-introduction.html"><strong aria-hidden="true">3.1.13.</strong> Lab Introduction</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-advanced-load-balancer-cloud-preparation.html"><strong aria-hidden="true">3.1.14.</strong> NSX Advanced Load Balancer Cloud preparation</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/avi-kubernetes-operator-for-tkg.html"><strong aria-hidden="true">3.1.15.</strong> Avi Kubernetes Operator for TKG</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/tkg-workload-l4-load-balancing.html"><strong aria-hidden="true">3.1.16.</strong> TKG Workload L4 load Balancing</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/tkg-workload-l7-load-balancing.html"><strong aria-hidden="true">3.1.17.</strong> TKG Workload L7 Load Balancing</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/tkg-workload-security-with-antrea-networkPolicy.html"><strong aria-hidden="true">3.1.18.</strong> TKG Workload Security with Antrea NetworkPolicy</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-cloud-environment-overview.html"><strong aria-hidden="true">3.1.19.</strong> NSX Cloud Environment Overview</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/validate-csm-registration-with-nsx-manager.html"><strong aria-hidden="true">3.1.20.</strong> Validate CSM Registration with NSX Manager</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/enable-csm-to-access-your-aws-inventory.html"><strong aria-hidden="true">3.1.21.</strong> Enable CSM to access your AWS inventory</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-enforced-mode-prepare-workloads.html"><strong aria-hidden="true">3.1.22.</strong> NSX Enforced Mode - Prepare workloads in Self-Managed/Transit AWS VPC</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-enforced-mode-deploy-nsx-pcg.html"><strong aria-hidden="true">3.1.23.</strong> NSX Enforced Mode - Deploy NSX PCG in a Self-Managed/Transit VPC</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-enforced-mode-onboard-workload-vms.html"><strong aria-hidden="true">3.1.24.</strong> NSX-Enforced Mode - Onboard Workload VMs</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-enforced-mode-connect-on-premise-dc-with-aws-vpc-leveraging-ipsec-vpn.html"><strong aria-hidden="true">3.1.25.</strong> NSX Enforced mode - Connect on-premise DC with AWS VPC leveraging IPSEC VPN</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-enforced-mode-setup-micro-segmentation-for-workloads.html"><strong aria-hidden="true">3.1.26.</strong> NSX Enforced Mode - Setup Micro-segmentation for workloads</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/onboarding-into-avi-load-balancer.html"><strong aria-hidden="true">3.1.27.</strong> Onboarding into AVI Load Balancer</a></li><li class="chapter-item expanded "><a href="../../vcn/livefire/nsx-enforced-mode-threat-detection-and-remediation-using-the-quarantine-policy.html"><strong aria-hidden="true">3.1.28.</strong> NSX Enforced Mode - Threat detection and remediation using the Quarantine policy</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx/index.html"><strong aria-hidden="true">3.2.</strong> NSX Data Center</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx/installation.html"><strong aria-hidden="true">3.2.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/sdwan/index.html"><strong aria-hidden="true">3.3.</strong> SD-WAN by VeloCloud</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/sdwan/installation.html"><strong aria-hidden="true">3.3.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx-alb/index.html"><strong aria-hidden="true">3.4.</strong> NSX Adv Load Balancer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx-alb/installation.html"><strong aria-hidden="true">3.4.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx-fw/index.html"><strong aria-hidden="true">3.5.</strong> NSX Service-defined Firewall</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx-fw/installation.html"><strong aria-hidden="true">3.5.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx-cloud/index.html"><strong aria-hidden="true">3.6.</strong> NSX Cloud</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx-cloud/installation.html"><strong aria-hidden="true">3.6.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx-int/index.html"><strong aria-hidden="true">3.7.</strong> NSX Intelligence</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx-int/installation.html"><strong aria-hidden="true">3.7.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/vrni/index.html"><strong aria-hidden="true">3.8.</strong> vRealize Network Insight</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/vrni/installation.html"><strong aria-hidden="true">3.8.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx-sm/index.html"><strong aria-hidden="true">3.9.</strong> NSX Service Mesh</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx-sm/installation.html"><strong aria-hidden="true">3.9.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/nsx-ids/index.html"><strong aria-hidden="true">3.10.</strong> NSX Distributed IDS/IPS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/nsx-ids/installation.html"><strong aria-hidden="true">3.10.1.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../vcn/hcx/index.html"><strong aria-hidden="true">3.11.</strong> HCX</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../vcn/hcx/installation.html"><strong aria-hidden="true">3.11.1.</strong> Installation</a></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../about.html">about</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">khyoon&#x27;s VMware Note</h1>

                    <div class="right-buttons">
                        
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="34-replace-existing-load-balancer"><a class="header" href="#34-replace-existing-load-balancer">3.4 Replace existing Load Balancer</a></h1>
<blockquote>
<p>In this module we will replace the existing LB solution and deploy the first Virtual Service. We will also see how the integration works and which objects will be created in vSphere and NSX-T.</p>
</blockquote>
<h2 id="1-check-existing-solution"><a class="header" href="#1-check-existing-solution">1. Check Existing Solution</a></h2>
<p>Before we create the virtual service in ALB, we need to check out the existing solution.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/600/medium/e1cbe995-5615-4838-822c-25425521c0bd.png" alt="" /></p>
<p>Clicking on the bookmark <strong>3-Tiers-WebApp</strong> in your browser will point to an address: <a href="https://webapp.corp.local/cgi-bin/app.py">https://webapp.corp.local/cgi-bin/app.py</a></p>
<p>Repetitive clicks on the bookmark will reveal that the LB will alternate between <strong>172.16.10.11</strong> and <strong>172.16.10.12</strong></p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/399/medium/33770078-6ca9-42b3-9159-b2b1196f0b25.png" alt="" /></p>
<p>Looking at the inventory in vCenter Server, we can identify the load balancer VM <strong>lb-01a</strong> with the IP address <strong>172.16.10.10.</strong> The DNS entry <strong>webapp.corp.local</strong> will point to this IP.</p>
<h2 id="2-replacement-process"><a class="header" href="#2-replacement-process">2. Replacement Process</a></h2>
<h3 id="21-import-the-certificates"><a class="header" href="#21-import-the-certificates">2.1. Import the Certificates</a></h3>
<p>Remember: the customer insisted on using the existing certificates and using the same IP for the ALB based service.</p>
<p>So we have to first import the certificates. We can find them in the /etc/nginx/ssl directory of lb-01a.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/602/medium/25f83f9b-7f03-4152-ac14-0948bb929c6b.png" alt="" /></p>
<p>Please open a Command Prompt on your controlcenter VM.</p>
<ol>
<li>To make sure we can easily find the downloaded files, change to the directory Downloads: <code>cd Downloads</code></li>
<li>Initiate the download using: <code>scp root@172.16.10.10:/etc/nginx/ssl/webapp.* .</code> Use password: VMware1!</li>
<li>Three files should be downloaded. We can ignore the .conf file, but we are intersted in the .key and the .pem file.</li>
</ol>
<p>Please re-open the tab pointing to the ALB management UI.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/604/medium/a387013c-0794-4f42-aaae-1afddc9fbe68.png" alt="" /></p>
<ol>
<li>Switch to the <strong>Templates</strong> scope using the system menu in the top left corner.</li>
<li>Click <strong>Security</strong></li>
<li>Make sure you are viewing the <strong>SSL/TLS Certificates</strong> tab</li>
<li>Click <strong>CREATE</strong> and select <strong>Application Certificate</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/606/original/58971142-272e-4610-90e5-8ad4d822e936.png" alt="" /></p>
<ol>
<li>Enter a name for the certificate: <strong>webapp.corp.local</strong></li>
<li>Type: <strong>Import</strong></li>
<li>In the Certificate row select <strong>Upload File</strong> and click on the button below</li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/608/medium/5f994848-b21b-4f26-bfc4-c2cc337cc5de.png" alt="" /></p>
<ol>
<li>Point the file manager to the Downloads directory and select: <strong>webapp.pem</strong></li>
<li>Click <strong>Open</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/610/original/9ee60ef4-b75c-4402-b54a-f94859d863c2.png" alt="" /></p>
<ol>
<li>Repeat the step above for the Key file in the next row. Upload the file <strong>webapp.key</strong></li>
<li>Then click <strong>Validate</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/409/original/fa902029-b814-42dc-8d81-1a7b807424f1.png" alt="" /></p>
<p>The content of the certificate files is now shown in the UI.</p>
<p>Click <strong>Save</strong></p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/612/medium/ebd42d3a-bfa3-4502-8ab4-db97daa407ba.png" alt="" /></p>
<p>The certificate along some information about it should appear now in the list of certificates.</p>
<p>Now we are ready to create the Virtual Service!</p>
<h3 id="22-create-virtual-service"><a class="header" href="#22-create-virtual-service">2.2. Create Virtual Service</a></h3>
<blockquote>
<p>The VS setup is a multi-step process. Please do not rush through the next steps and read the instructions carefully.</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/825/medium/5286e055-1f71-44b9-b020-dbaeefb67418.png" alt="" /></p>
<ol>
<li>Select <strong>Applications</strong> from the systems menu.</li>
<li>Click <strong>Dashboard</strong></li>
<li>Click <strong>CREATE VIRTUAL SERVICE</strong> and choose <strong>Advanced Setup</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/827/medium/996571ff-ee85-4fa5-9f59-7522a9f335ce.png" alt="" /></p>
<ol>
<li>Select the NSX-T Cloud: <strong>nsxmgr-01</strong></li>
<li>Click <strong>Next</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/829/medium/b30edaff-9241-43ea-8db3-5f650c43cb47.png" alt="" /></p>
<ol>
<li>Name: <strong>webapp.corp.local</strong></li>
<li>Enter the FQDN: <strong>webapp.corp.local</strong> - you will notice that the field below will be automatically populated with the IP.</li>
<li>Select the Application Profile: <strong>System-Secure-HTTP</strong></li>
</ol>
<p>Please scroll down to the bottom of the page.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/831/medium/b5d0e74d-1ca9-484d-8310-1ff6e91c5fc6.png" alt="" /></p>
<ol>
<li>To tell the ALB which routing context we are using we have to select the Tier1 Logical Router: <strong>T1-GATEWAY</strong></li>
<li>Set the Service Port to: **443<br />
**and make sure you have enabled <strong>SSL</strong></li>
<li>Please open the drop-down menu of the <strong>SSL Certificates</strong> field and</li>
<li>select the previous imported certificate: <strong>webapp.corp.local</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/833/medium/cba3cd44-a553-4979-9f14-59b4d185ecbd.png" alt="" /></p>
<ol>
<li>Please remove the <strong>System-Default-Cert</strong> form the list of SSL Certificates by clicking the X as indicated in the screenshot.</li>
<li>Click the drop-down menu in the <strong>Pool</strong> field</li>
<li>and select <strong>Create Pool</strong></li>
</ol>
<h4 id="221-create-server-pool"><a class="header" href="#221-create-server-pool">2.2.1. Create Server Pool</a></h4>
<blockquote>
<p>This will open the Pool setup wizard.</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/835/medium/4fe7c545-04b5-4f83-a563-ca3ef3bc75cc.png" alt="" /></p>
<ol>
<li>The system will put in a name based on the VS name. This will work for us</li>
<li>Default Service Port: <strong>443</strong></li>
<li>Set the Load Balance algorithm to: <strong>Round Robin</strong></li>
<li>Tier1 Logical Router: <strong>T1-GATEWAY</strong></li>
<li>Add an Active Monitor: <strong>System-HTTPS</strong></li>
</ol>
<p>Please scroll down.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/837/medium/c8c279ae-e3b3-4e0e-bf05-2150aece56b7.png" alt="" /></p>
<ol>
<li>Please <strong>Enable SSL</strong></li>
<li>Select SSL Profile: <strong>System-Standard</strong></li>
<li>Click <strong>Next</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/839/medium/5fc30755-b549-420e-af74-da7f088ebc0f.png" alt="" /></p>
<p>Next we have to define the server pool members. The ALB reads the inventory of NSX-T manager and also the Security Groups defined - the Group WEB contains both the web servers of the WebApp.</p>
<ol>
<li>Please select <strong>Security Groups</strong></li>
<li>Choose NSX Security Group <strong>WEB</strong></li>
<li>Click <strong>Next</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/428/234/medium/4daaea7b-a8b7-42b4-8213-c465b956f26f.png" alt="" /></p>
<p>No need to change any values here. Click <strong>Next</strong>.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/428/236/medium/23665fcd-d6a7-4cbc-8c7c-a03b031de1cf.png" alt="" /></p>
<p>Click <strong>Save</strong>.</p>
<p>Pool created! Back on the Virtual Service configuration screen:</p>
<blockquote>
<p>This concludes the Pools setup wizard and will bring us back to the VS configuration dialogue.</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/922/medium/ffeac45d-fcb7-466d-9786-3b73c3934052.png" alt="" /></p>
<ol>
<li>Please set the SSL Profile for the VS to: <strong>System-Standard</strong></li>
<li>Verify that the new pool is shown in the Pool field</li>
<li>and that there is only the <strong>webapp.corp.local</strong> certificate listed in the SSL Certificate field</li>
<li>Click <strong>Next</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/849/medium/0aac9128-e7e3-4945-8007-104436b4bae3.png" alt="" /></p>
<p>We will leave the <strong>Policies</strong> tab empty for now. You will create some policies in Optimization &amp; Operations lab.</p>
<p>Click <strong>Next</strong></p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/851/medium/839cae84-45ed-480e-9e3c-b81131079ece.png" alt="" /></p>
<p>For our lab we want to make sure to log everything.</p>
<ol>
<li>Activate: <strong>Log all headers</strong></li>
<li>Enable: <strong>Non-significant logs</strong></li>
<li>Set the Non-significant log duration to: **0<br />
**0 will set it to indefinitely. Please do not use this setting in production environments!</li>
<li>Click <strong>Next</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/425/medium/71358725-55d8-44f3-9e5b-a258ce5df552.png" alt="" /></p>
<p>No need to change anything on the Advances screen. Just click <strong>Save</strong></p>
<h3 id="23-virtual-service-deployment-in-progress"><a class="header" href="#23-virtual-service-deployment-in-progress">2.3. Virtual Service Deployment in Progress</a></h3>
<blockquote>
<p>Now that we have configured the fist VS the SE deployment is triggered.</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/969/medium/eb86215c-4416-45d6-9599-6f423ce4d3ee.png" alt="" /></p>
<p>Your screen should look similar to the one above. If not: Open the Virtual Services tab in the Application section and click the webapp.corp.local.</p>
<p>First you will notice the red exclamation mark in the top right corner. Please place your mouse over it then a message box appears indicating that the SE deployment is in progress.</p>
<p>This will take some time, in the meantime we want to explore what happens behind the scenes.</p>
<h3 id="24-what-happens-in-vsphere"><a class="header" href="#24-what-happens-in-vsphere">2.4. What happens in vSphere?</a></h3>
<p>Please open the browser tab pointing to vCenter Server.</p>
<h4 id="241-shutdown-existing-load-balancer"><a class="header" href="#241-shutdown-existing-load-balancer">2.4.1. Shutdown Existing Load Balancer</a></h4>
<p>Lets shut down the old load balancer VM.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/853/medium/9cdd9414-35d1-49f0-8e6e-c0fced7a942f.png" alt="" /></p>
<ol>
<li>In the <strong>Host &amp; Cluster</strong> View</li>
<li>Look for the <strong>lb-01a</strong> virtual machine</li>
<li>and <strong>shut it down</strong>.</li>
</ol>
<h4 id="242-service-engine-vms-being-deployed"><a class="header" href="#242-service-engine-vms-being-deployed">2.4.2. Service Engine VMs being deployed</a></h4>
<p>The SEs are still being deployed....</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/855/medium/114851ca-cb8d-49d5-8ecd-6b53188dca42.png" alt="" /></p>
<p>You can see two powered down VMs in the vCenter's inventory.</p>
<blockquote>
<p>Note: the last five letters in the SE name might be different in your environment. These are random generated names!</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/431/original/d07ef1c8-c1d0-403d-8fff-7dd3cbb22bdb.png" alt="" /></p>
<p>After a few minutes the SE VMs should be shown as powered on. <strong>This might take some time - what about a coffee?</strong></p>
<blockquote>
<p>Can you explain how the SE names have been generated?</p>
<ul>
<li>We set the ALB prefix during NSX-T Cloud Setup and</li>
<li>DefaultGroup was set in the SE Group profile</li>
</ul>
</blockquote>
<h5 id="2421-content-library"><a class="header" href="#2421-content-library">2.4.2.1. Content Library</a></h5>
<p>Lets check out the Content Library.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/925/original/35368321-b5ec-40b1-b306-b889e6bae811.png" alt="" /></p>
<ol>
<li>Click <strong>Menu</strong></li>
<li>Click <strong>Content Library</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/927/medium/744e95ed-8543-4cd3-bddc-b76c8a5cf704.png" alt="" /></p>
<p>After clicking the <strong>NSX Advanced Loadbalancer</strong> library you will the ALB uploaded an OVA to vCenter Server.</p>
<p>Please note: the version number in your pod might be different.</p>
<h3 id="25-objects-created-in-nsx-t"><a class="header" href="#25-objects-created-in-nsx-t">2.5. Objects Created in NSX-T</a></h3>
<p>Now lets take a look on all the objects that have been created by the Advanced Load Balancer.</p>
<p>Please open the tab pointing to the NSX-T Manager UI.</p>
<h4 id="251-groups"><a class="header" href="#251-groups">2.5.1. Groups</a></h4>
<p>To aide security administrators with rule management the ALB created some groups in NSX-T and populated them with the IPs of the different objects.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/929/medium/6b4d5e43-657f-45da-8586-34ec6d04cf86.png" alt="" /></p>
<ol>
<li>Please click <strong>Inventory</strong> in top menu bar.</li>
<li>Select <strong>Groups</strong></li>
<li>The groups created by the ALB are prefixed as defines with ALB-<br />
Note: it might take some time to see the <strong>ALB-webapp*</strong> groups.</li>
<li>Please feel free to view the group members.</li>
</ol>
<p>Please see the following link for more information regarding Security Automation:<br />
https://avinetworks.com/docs/20.1/nsx-t-design-guide/#security-automation</p>
<h4 id="252-services"><a class="header" href="#252-services">2.5.2. Services</a></h4>
<p>Now lets see the Service definitions.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/931/medium/37d8e95b-8a7b-4e23-ba97-a58c41718bb0.png" alt="" /></p>
<ol>
<li>Still on the Inventory tab, select <strong>Services</strong></li>
<li>Use a filter for <strong>ALB</strong> to view the services configured by the Controller.</li>
<li>You will get a list of services used by the NSX Advanced LB</li>
<li>Optional: check the Tags assigned to the services.</li>
</ol>
<h4 id="253-se-management-segments"><a class="header" href="#253-se-management-segments">2.5.3. SE Management Segments</a></h4>
<p>Let take a look on the SE Management segment we crated at the beginning.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/942/medium/90e6fe14-da5c-4461-b74d-46cdbc850bb9.png" alt="" /></p>
<ul>
<li>Click <strong>Networking</strong></li>
<li>Switch to the <strong>Segments</strong> view</li>
<li>Locate the <strong>OV-LBMGMT</strong> segment</li>
<li>Click the number in the <strong>Ports</strong> column.</li>
</ul>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/944/medium/dbd34425-d33a-446b-ab56-135e431f3532.png" alt="" /></p>
<p>You can see the two SEs that have been deployed in the list.</p>
<h4 id="254-static-routes"><a class="header" href="#254-static-routes">2.5.4. Static Routes</a></h4>
<p>During the lecture we learned that the ALB uses static routes to advertise the virtual service IPs.</p>
<p>So then lets see what we can find on the T1 that we used in our setup.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/971/medium/4f0f64aa-0e60-47ae-9a2c-908ab9a06094.png" alt="" /></p>
<ol>
<li>Still on the Networking tab, select <strong>Tier-1 Gateways</strong></li>
<li>Locate the <strong>T1-GATEWAY</strong> and open the details view by clicking on the triangle.</li>
<li>Next expand the <strong>STATIC ROUTES</strong></li>
<li>Click the <strong>1</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/973/original/a5b80497-755c-41ed-9644-38250cd3b2d1.png" alt="" /></p>
<ol>
<li>In the <strong>Network</strong> column you will see the VIP of the WebApp virtual service.</li>
<li>Click the <strong>1</strong> in the <strong>Next Hops</strong> column</li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/975/original/69b81a6a-01e3-411b-b30b-c8b59ff0793c.png" alt="" /></p>
<ol>
<li>The IP address is the IP of the SE running the virtual service.</li>
<li>Click <strong>CLOSE</strong></li>
</ol>
<p>Please also close all other dialogue windows. Meanwhile the virtual service should be up and running... lets see!</p>
<h2 id="3-virtual-service-deployment-check"><a class="header" href="#3-virtual-service-deployment-check">3. Virtual Service Deployment Check</a></h2>
<p>Please re-open the tab pointing to the management UI of the ALB.</p>
<p>This is the screen we left in step 2.3:</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/284/977/medium/b4089749-352b-49b8-80ce-78b7050dd95f.png" alt="" /></p>
<p>Place the mouse over the icon in the top right corner to get an overview of the status of the virtual service.</p>
<blockquote>
<p>You get to the screen shown above by navigating:</p>
<p>Applications &gt; Virtual Services &gt; click webapp.corp.local</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/589/medium/c253b1f0-d8cb-4800-bbb7-c3dc73d8bbe7.png" alt="" /></p>
<p>Lets get more information about the status of the virtual service: Please place your mouse over the virtual service name.</p>
<p>You will see the service uptime, configured ports and IPs.</p>
<p>You can also identify the Service Engine that the VS is hosted on -&gt; note the name we will take a look at it in vSphere in a moment.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/285/060/medium/07d6b9a2-a031-404d-9b8a-bf483fa6978e.png" alt="" /></p>
<ol>
<li>Click <strong>Events</strong></li>
<li>In the table you can see a list of all the event related to this VS. You can view details to every entry by clicking the <strong>+</strong> sign on the right.</li>
</ol>
<h3 id="31-optional-check-se-in-vsphere"><a class="header" href="#31-optional-check-se-in-vsphere">3.1. Optional: Check SE in vSphere</a></h3>
<p>We identified the SE that the VS is hosted on in a previous step</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/591/medium/df35c1b7-e4ce-4dc2-9521-b5872737219e.png" alt="" /></p>
<p>When you check out the configuration of the VM, you will notice that it is connected to the OV-LBMGMT and the OV-WEB segments.</p>
<h3 id="32-server-pool"><a class="header" href="#32-server-pool">3.2. Server Pool</a></h3>
<p>Next we will take a look on the server pool.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/285/089/medium/451ebc53-44df-4e6a-ac20-c5a01311ab52.png" alt="" /></p>
<ol>
<li>You should be still on the Applications screen. Now switch to <strong>Pools.</strong></li>
<li>Click <strong>webapp.corp.local-pool</strong></li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/285/091/medium/9dd9c357-f106-41c2-8baf-31eb1526d793.png" alt="" /></p>
<ol>
<li>Click <strong>Servers</strong> to get to the list of the pool members.</li>
<li>Next click one of the IPs in the <strong>Server Name</strong> column.</li>
</ol>
<p><img src="https://media.screensteps.com/image_assets/assets/004/285/093/medium/c9b69238-4398-4708-bb08-225a0c93c5d9.png" alt="" /></p>
<p>On this page you can see the results provided by the Health Monitors.</p>
<ol>
<li>In our case we have an Passive monitor, that cannot be configured. 
And an active one: <strong>System-HTTPS</strong></li>
<li>Details of the heath monitor results can be viewed by clicking the <strong>+</strong> icon on the right.</li>
<li>Please go back to the Pools overview by clicking the arrow sign in the top left corner.</li>
</ol>
<blockquote>
<p>If you pool members are marked down after VS creation. Check out the results of the active health monitor.</p>
<p>Sometimes its just the wrong response that marks your servers down!</p>
</blockquote>
<p><img src="https://media.screensteps.com/image_assets/assets/004/139/601/medium/50663b79-b0f5-4ddb-92a0-912865a34254.png" alt="" /></p>
<p>Back on the Pools page, click <strong>Events</strong>. Please feel free to view the details of the events of the server pool.</p>
<p>Meanwhile you should have noticed that the +/- are always used to expand/fold fields in the UI.   :-)</p>
<h3 id="33-service-engines"><a class="header" href="#33-service-engines">3.3. Service Engines</a></h3>
<p>In a final step we just want to take a look on the SEs:</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/285/138/medium/591a5506-c1b9-4031-95bd-24420cbe97be.png" alt="" /></p>
<ol>
<li>Please switch to the <strong>Infrastructure</strong> context using the system menu in the top left corner.</li>
<li>Click <strong>Service Engine</strong></li>
<li>Select the NSX-T cloud: <strong>nsxmgr-01a</strong></li>
</ol>
<p>In my case the VS was placed on the first SE and I can view all active VS on a SE by expanding the line using the + signal on the right.</p>
<h2 id="4-access-webapp"><a class="header" href="#4-access-webapp">4. Access WebApp</a></h2>
<p>Finally, we want to check our virtual service.</p>
<p><img src="https://media.screensteps.com/image_assets/assets/004/115/744/medium/c24668d0-7d43-44d5-9819-0c464a5987e3.png" alt="" /></p>
<p>Please open a new tab in Chrome and click the bookmark 3-Tiers-WebApp. Your screen should look similar to the screenshot above.</p>
<p>Repetitive clicks will switch between the two IPs: .11 and .12. If this is not the case in your environment, please check the LB algorithm set at the server pool.</p>
<blockquote>
<p>Congratulations! You have successfully deployed a virtual service in NSX Advanced Load Balancer.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../vcn/livefire/setup-nsx-t-cloud.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../vcn/livefire/optional-service-optimization-and-operations.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../vcn/livefire/setup-nsx-t-cloud.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../vcn/livefire/optional-service-optimization-and-operations.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
